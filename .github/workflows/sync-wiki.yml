name: Sync docs to Wiki

on:
  push:
    branches: [ main, master ]
    paths:
      - 'docs/**'
  workflow_dispatch:

jobs:
  sync-wiki:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        path: repo

    - name: Checkout wiki
      uses: actions/checkout@v4
      with:
        repository: ${{ github.repository }}.wiki
        path: wiki
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Sync docs to wiki
      run: |
        # docsãƒ•ã‚©ãƒ«ãƒ€ã®å†…å®¹ã‚’Wikiã«ã‚³ãƒ”ãƒ¼
        rm -rf wiki/*
        cp -r repo/docs/* wiki/
        
        # Wikiã®ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã‚’ä½œæˆ
        echo "# VC Tracker Documentation" > wiki/Home.md
        echo "" >> wiki/Home.md
        echo "## ðŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€è¦§" >> wiki/Home.md
        echo "" >> wiki/Home.md
        echo "### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰" >> wiki/Home.md
        echo "- [Discord Bot ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](setup/DISCORD_BOT_SETUP)" >> wiki/Home.md
        echo "- [Slack Bot ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](setup/SLACK_BOT_SETUP)" >> wiki/Home.md
        echo "- [Google Sheets ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](setup/GOOGLE_SHEETS_SETUP)" >> wiki/Home.md
        echo "" >> wiki/Home.md
        echo "### é–‹ç™ºã‚¬ã‚¤ãƒ‰" >> wiki/Home.md
        echo "- [é–‹ç™ºç’°å¢ƒæ§‹ç¯‰](DEVELOPMENT)" >> wiki/Home.md
        echo "- [ç’°å¢ƒåˆ¥è¨­å®š](ENVIRONMENTS)" >> wiki/Home.md
        echo "- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¬ã‚¤ãƒ‰](SECURITY)" >> wiki/Home.md
        echo "- [CI/CDã‚¹ã‚­ãƒƒãƒ—æ–¹æ³•](CI_CD_SKIP)" >> wiki/Home.md
        
    - name: Commit and push to wiki
      working-directory: wiki
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        
        if [ -n "$(git status --porcelain)" ]; then
          git add -A
          git commit -m "Sync docs from main repository"
          git push
        else
          echo "No changes to commit"
        fi