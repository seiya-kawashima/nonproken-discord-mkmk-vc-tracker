# Google Sheetsクライアント仕様書

## 📌 このドキュメントについて

このドキュメントは、**Discordのボイスチャンネル（VC）にログインした人の記録をGoogleスプレッドシートに保存するプログラム**の設計書です。
エクセルのような表計算ソフトに自動でデータを記録する仕組みを、分かりやすく説明します。

---

## 1. 🎯 何をするプログラム？

### このプログラムの役割
想像してみてください。学校の出席簿のように、**「今日誰が来たか」を自動でGoogleスプレッドシートに記録してくれる電子秘書**のようなものです。

### 具体的にできること
- ✅ Discordで誰がVCに参加したかを記録
- ✅ 日付ごとに出席状況を管理
- ✅ 各メンバーの通算参加日数を集計
- ✅ データを自動でGoogleスプレッドシートに保存

### 使用例
- **コミュニティの活動記録**: 誰がいつ参加したかを記録
- **出席管理**: オンライン勉強会やミーティングの出席確認
- **統計データ**: メンバーの活動頻度を把握

---

## 2. 📥 Input（入力）

### このプログラムが受け取る情報

| 項目 | 型 | 説明 | 例 |
|------|-----|------|-----|
| **サービスアカウントJSON** | ファイルパス | Googleの認証ファイルの場所 | service_account.json |
| **スプレッドシート名** | 文字列 | 記録先のスプレッドシートの名前 | VC出席記録 |
| **メンバーリスト** | リスト | VCにいる人の情報 | 下記参照 |

### 入力データの構造（メンバーリスト）
```json
[
  {
    "guild_id": "123456789012345678",
    "user_id": "111111111111111111",
    "user_name": "田中太郎#1234"
  }
]
```

---

## 3. 📤 Output（出力）

### このプログラムが返す情報

| 機能 | 出力 | 型 | 説明 | 例 |
|------|------|-----|------|-----|
| **記録処理** | 処理結果 | 辞書 | 新規・更新件数 | {"new": 3, "updated": 2} |
| **日数取得** | 通算日数 | 整数 | 特定ユーザーの参加日数 | 45 |
| **今日のメンバー** | メンバーリスト | リスト | 今日参加した人のリスト | 下記参照 |

### 出力データの構造（今日のメンバー）
```json
[
  {
    "date_jst": "2025-01-20",
    "guild_id": "123456789012345678",
    "user_id": "111111111111111111",
    "user_name": "田中太郎#1234",
    "present": "TRUE"
  }
]
```

---

## 4. 🔧 どうやって動く？

### 動作の流れ（出席簿をつけるように）

1. **準備** 📚
   - Googleスプレッドシートを用意
   - 記録用の表（ワークシート）を作成
   - 表の見出し（日付、名前など）を設定

2. **データ受け取り** 📨
   - DiscordのVCに誰がいるかの情報を受け取る
   - 今日の日付を確認

3. **記録作業** ✏️
   - すでに今日の記録があるか確認
   - 新しい人は新規追加
   - すでにある人は「出席」に更新

4. **集計** 🧮
   - 各メンバーの通算参加日数を計算
   - 今日の参加者リストを作成

---

## 3. 📊 どんな情報を記録する？

### スプレッドシートの構造（表のイメージ）

| 日付 | サーバーID | ユーザーID | ユーザー名 | 出席 |
|------|------------|------------|------------|------|
| 2025-01-20 | 123456... | 111111... | 田中太郎#1234 | ✓ |
| 2025-01-20 | 123456... | 222222... | 鈴木花子#5678 | ✓ |
| 2025-01-21 | 123456... | 111111... | 田中太郎#1234 | ✓ |

### 各項目の説明

| 項目 | 説明 | 例 |
|------|------|-----|
| **日付** | 記録した日（日本時間） | 2025-01-20 |
| **サーバーID** | Discordサーバーの識別番号 | 123456789012345678 |
| **ユーザーID** | 各ユーザーの識別番号 | 111111111111111111 |
| **ユーザー名** | 表示される名前 | 田中太郎#1234 |
| **出席** | VCに参加したかどうか | TRUE（参加）/ FALSE（不参加） |

---

## 4. 🚀 使い始めるために必要なもの

### 事前準備チェックリスト

#### 1. Googleアカウントの準備
- [ ] Googleアカウントを持っている
- [ ] Googleスプレッドシートが使える
- [ ] Google Cloud Consoleにアクセスできる

#### 2. サービスアカウントの作成（ロボット用のアカウント）
1. **Google Cloud Consoleにアクセス**
   - [console.cloud.google.com](https://console.cloud.google.com)を開く
   
2. **新しいプロジェクトを作成**
   - プロジェクト名を入力（例：discord-vc-tracker）
   
3. **サービスアカウントを作成**
   - 「IAMと管理」→「サービスアカウント」を選択
   - 「サービスアカウントを作成」をクリック
   - 名前を入力（例：sheets-writer）
   
4. **認証キーをダウンロード**
   - JSONキーを作成してダウンロード
   - このファイルは**パスワードのように大切に保管**

#### 3. スプレッドシートの設定
1. **新しいスプレッドシートを作成**
   - Googleドライブで新規作成
   - わかりやすい名前をつける（例：VC出席記録）
   
2. **サービスアカウントと共有**
   - スプレッドシートの「共有」ボタンをクリック
   - サービスアカウントのメールアドレスを入力
   - 「編集者」権限を付与

#### 4. 環境設定
```
GOOGLE_SERVICE_ACCOUNT_JSON=認証キーファイルのパス
GOOGLE_SHEET_NAME=スプレッドシートの名前
```

---

## 5. ⚠️ 注意事項とトラブルシューティング

### よくある問題と解決方法

#### 問題1：スプレッドシートに接続できない
**原因と対策：**
- 認証キーが間違っている → JSONファイルを確認
- スプレッドシート名が違う → 正確な名前を設定
- 共有設定が不足 → サービスアカウントに編集権限を付与

#### 問題2：データが記録されない
**原因と対策：**
- 権限不足 → スプレッドシートの共有設定を確認
- API制限に達した → 少し時間を置いて再試行
- ワークシートが存在しない → 自動作成されるまで待つ

### エラーメッセージの意味

| エラー | 意味 | 対処法 |
|--------|------|--------|
| "Authentication failed" | 認証に失敗しました | 認証キーファイルを確認 |
| "Spreadsheet not found" | スプレッドシートが見つかりません | 名前と共有設定を確認 |
| "Permission denied" | 権限がありません | 編集権限を付与 |
| "API quota exceeded" | API制限を超えました | 時間を置いて再試行 |

---

## 6. 🛡️ セキュリティについて

### 安全にデータを管理するために

1. **認証キーの保護** 🔐
   - JSONファイルは**絶対に公開しない**
   - Gitなどにアップロードしない
   - 環境変数で管理する

2. **アクセス権限** 🚪
   - 必要最小限の権限のみ付与
   - 定期的に共有設定を確認
   - 不要になったら権限を削除

3. **データの取り扱い** 📂
   - 個人情報は最小限に
   - 定期的にバックアップ
   - 不要なデータは削除

---

## 7. 📈 パフォーマンス（処理速度）について

### 処理時間の目安

| データ量 | 処理内容 | 処理時間 |
|----------|----------|----------|
| 10人 | 新規記録 | 1秒以下 |
| 50人 | 新規記録 | 2〜3秒 |
| 100人 | 新規記録 | 3〜5秒 |
| 1000件 | データ取得 | 2〜3秒 |

### 制限事項
- **API制限**: 100回/100秒までのリクエスト制限
- **セル数制限**: 1シートあたり最大1000万セル
- **同時アクセス**: 複数の処理が同時に書き込むと問題が起きる可能性

---

## 8. 📝 実際の使い方

### 基本的な操作の流れ

1. **毎日の出席記録**
   ```
   朝9時: プログラムが自動起動
   ↓
   VCに誰がいるか確認
   ↓
   スプレッドシートに記録
   ↓
   完了通知
   ```

2. **データの活用例**
   - **週次レポート**: 今週の参加者リスト
   - **月次集計**: 各メンバーの参加日数
   - **ランキング**: 最も活発なメンバー

### スプレッドシートの見方

#### シート構成
```
[VC出席記録]
├── daily_presence（日次出席データ）
└── （今後追加予定のシート）
```

#### データの読み方
- **TRUE**: その日にVCに参加した
- **FALSE**: 記録はあるが参加していない
- **空欄**: まだ記録がない

---

## 9. 💡 よくある質問（FAQ）

### Q1: 過去のデータも記録できますか？
**A:** いいえ、リアルタイムのデータのみ記録します。過去にさかのぼっての記録はできません。

### Q2: 複数のサーバーのデータを同じシートに記録できますか？
**A:** はい、サーバーIDで区別して記録するので可能です。

### Q3: データの保存期間は？
**A:** Googleスプレッドシートの容量制限内であれば無期限に保存できます。

### Q4: 自動でグラフは作れますか？
**A:** 現在は対応していませんが、スプレッドシートの機能で手動作成は可能です。

### Q5: エクセルでも使えますか？
**A:** このプログラムはGoogleスプレッドシート専用です。エクセルには対応していません。

---

## 10. 🔧 メンテナンスとアップデート

### 定期的な確認事項

#### 毎月確認すること
- [ ] スプレッドシートの容量
- [ ] API使用量
- [ ] エラーログ

#### 毎年確認すること
- [ ] Google APIの仕様変更
- [ ] 認証キーの更新
- [ ] 古いデータのアーカイブ

### データのバックアップ
1. **手動バックアップ**
   - スプレッドシートをダウンロード
   - Excel形式で保存
   
2. **自動バックアップ**
   - Googleドライブで自動保存
   - 定期的にコピーを作成

---

## 11. 🚧 今後の改善予定

### 近い将来追加したい機能
- 📊 自動グラフ生成
- 📧 週次レポートのメール送信
- 🎯 特定期間の集計機能
- 📱 スマホからの閲覧対応

### 長期的な目標
- 複数シートへの分散記録
- より高速な処理
- リアルタイムダッシュボード
- データ分析機能の強化

---

## 12. 📚 もっと詳しく知りたい方へ

### 関連用語集

| 用語 | 説明 |
|------|------|
| **Googleスプレッドシート** | Googleが提供する無料の表計算ソフト |
| **サービスアカウント** | プログラム用のGoogleアカウント |
| **API** | プログラム同士が通信する仕組み |
| **JSON** | データを保存する形式の一つ |
| **ワークシート** | スプレッドシート内の1つのシート |
| **Upsert** | データがあれば更新、なければ挿入する処理 |

### 参考リンク
- [Google Sheets API](https://developers.google.com/sheets/api) - 公式ドキュメント
- [Google Cloud Console](https://console.cloud.google.com) - サービスアカウント管理
- [gspread ドキュメント](https://docs.gspread.org/) - 使用ライブラリの説明

---

## 📞 サポート

問題が発生した場合は、以下の情報を準備してお問い合わせください：

1. **エラーメッセージ**の全文
2. **スプレッドシート名**
3. **いつ**エラーが発生したか
4. **どんな操作**をした時にエラーが起きたか
5. **認証設定**の確認状況

この仕様書は定期的に更新されます。最新版は常にこのファイルを参照してください。

---

*最終更新日: 2025年1月*