# Slack通知クライアント仕様書

## 📌 このドキュメントについて

このドキュメントは、**DiscordのVCに参加した人の情報をSlack（スラック）に自動で通知するプログラム**の設計書です。
チーム内の情報共有を自動化する仕組みを、初心者の方にも分かりやすく説明します。

---

## 1. 🎯 何をするプログラム？

### このプログラムの役割
想像してみてください。オフィスの受付係が「○○さんが出社しました」と社内チャットでお知らせするように、**DiscordのVCに誰が参加したかをSlackで自動的にお知らせする電子受付係**のようなものです。

### 具体的にできること
- ✅ VCに参加した人をリアルタイムでSlackに通知
- ✅ その人の通算参加日数を表示
- ✅ 100日目などの節目にお祝いメッセージ
- ✅ 1日の終わりに参加者のまとめを送信

### 使用例
- **リモートワーク**: 誰が作業を開始したか把握
- **オンラインコミュニティ**: メンバーの活動状況を共有
- **勉強会**: 参加者の出席状況を記録

---

## 2. 📥 Input（入力）

### このプログラムが受け取る情報

| 項目 | 型 | 説明 | 例 |
|------|-----|------|-----|
| **Botトークン** | 文字列 | SlackのBot認証トークン | xoxb-123456789... |
| **チャンネルID** | 文字列 | 通知先のチャンネル識別番号 | C1234567890 |
| **ユーザー名** | 文字列 | 通知する人の名前 | 田中太郎#1234 |
| **通算日数** | 整数 | その人の参加日数 | 45 |
| **メンバーリスト** | リスト | まとめ通知用のメンバー一覧 | ["田中", "鈴木", "山田"] |

### 入力の詳細
- **Botトークン**: Slack APIで発行される認証用の文字列
- **チャンネルID**: SlackのチャンネルURLから取得できるID
- **通算日数**: Google Sheetsから取得した累計参加日数

---

## 3. 📤 Output（出力）

### このプログラムが返す情報

| 機能 | 出力 | 型 | 説明 | 例 |
|------|------|-----|------|-----|
| **個別通知** | 送信結果 | 真偽値 | 通知の成功/失敗 | True（成功）/ False（失敗） |
| **まとめ通知** | 送信結果 | 真偽値 | まとめの成功/失敗 | True / False |
| **接続テスト** | 接続状態 | 真偽値 | 接続の可否 | True / False |

### 実際にSlackに送られるメッセージ
- **通常**: `🎤 田中太郎#1234 さんがログインしました！（通算 15 日目）`
- **節目**: `🎉 鈴木花子#5678 さんがログインしました！（通算 100 日目！おめでとう！）`
- **まとめ**: `📊 本日のVCログイン: 5名`

---

## 4. 🔧 どうやって動く？

### 動作の流れ（社内放送のように）

1. **準備** 📻
   - Slackのチャンネルを用意
   - 通知用のBot（ロボット）を設定
   - 通知先のチャンネルを指定

2. **情報受信** 📨
   - DiscordからVCの参加情報を受け取る
   - 誰が参加したか、何日目かを確認

3. **メッセージ作成** ✍️
   - 参加者の名前を含むメッセージを作成
   - 節目の日は特別なメッセージに
   - 絵文字を使って見やすく

4. **通知送信** 📤
   - Slackのチャンネルにメッセージを投稿
   - みんなが見られるように共有

---

## 3. 📊 どんな通知を送る？

### 通知の種類と例

#### 1. 通常の参加通知
```
🎤 田中太郎#1234 さんがログインしました！（通算 15 日目）
```

#### 2. 節目のお祝い通知（100日ごと）
```
🎉 鈴木花子#5678 さんがログインしました！（通算 100 日目！おめでとう！）
```

#### 3. 1日のまとめ通知
```
📊 本日のVCログイン: 5名
田中太郎, 鈴木花子, 山田一郎, 佐藤次郎, 高橋三郎
```

### 絵文字の意味

| 絵文字 | 意味 | 使用場面 |
|--------|------|----------|
| 🎤 | 通常参加 | 普通の日の参加通知 |
| 🎉 | お祝い | 100日、200日などの節目 |
| 📊 | まとめ | 1日の参加者リスト |

---

## 4. 🚀 使い始めるために必要なもの

### 事前準備チェックリスト

#### 1. Slackワークスペースの準備
- [ ] Slackアカウントを持っている
- [ ] 管理者権限がある（Appを追加するため）
- [ ] 通知を送りたいチャンネルがある

#### 2. Slack Appの作成（通知ロボットの準備）

##### ステップ1: Slack APIにアクセス
1. [api.slack.com](https://api.slack.com)を開く
2. 「Your Apps」をクリック
3. 「Create New App」を選択

##### ステップ2: Appの基本設定
1. App名を入力（例：VC通知Bot）
2. ワークスペースを選択
3. 「Create App」をクリック

##### ステップ3: 権限の設定
1. 「OAuth & Permissions」を選択
2. 以下の権限を追加：
   - `chat:write` - メッセージを送る権限
   - `chat:write.public` - 公開チャンネルに送る権限

##### ステップ4: ワークスペースにインストール
1. 「Install to Workspace」をクリック
2. 権限を確認して「許可する」
3. Bot User OAuth Tokenをコピー（xoxb-で始まる文字列）

#### 3. チャンネルの設定
1. **通知を送りたいチャンネルを開く**
2. **チャンネル名をクリック**
3. **チャンネルIDをメモ**（URLの末尾のC1234567890のような文字列）
4. **Botをチャンネルに招待**（/invite @ボット名）

#### 4. 環境設定
```
SLACK_BOT_TOKEN=xoxb-から始まるトークン
SLACK_CHANNEL_ID=C1234567890のようなチャンネルID
```

---

## 5. ⚠️ 注意事項とトラブルシューティング

### よくある問題と解決方法

#### 問題1：メッセージが送信されない
**原因と対策：**
- Botトークンが間違っている → トークンを再確認
- チャンネルIDが違う → 正しいIDを設定
- Botがチャンネルに招待されていない → `/invite @ボット名`で招待

#### 問題2：「権限がありません」エラー
**原因と対策：**
- 必要な権限が不足 → OAuth Scopesを再確認
- Appの再インストールが必要 → 権限変更後は再インストール

#### 問題3：通知が遅い・届かない
**原因と対策：**
- API制限に達した → 1秒に1メッセージまでの制限
- ネットワークの問題 → 接続を確認

### エラーメッセージの意味

| エラー | 意味 | 対処法 |
|--------|------|--------|
| "channel_not_found" | チャンネルが見つかりません | チャンネルIDを確認 |
| "not_in_channel" | Botがチャンネルにいません | Botを招待する |
| "invalid_auth" | 認証に失敗しました | トークンを確認 |
| "rate_limited" | 送信制限を超えました | 少し待ってから再試行 |

---

## 6. 🛡️ セキュリティについて

### 安全に使うための注意点

1. **トークンの管理** 🔐
   - Botトークンは**パスワードと同じ**
   - 絶対に公開しない
   - Gitにアップロードしない
   - 環境変数で管理する

2. **チャンネルの選択** 🚪
   - 機密情報を扱うチャンネルは避ける
   - 公開チャンネルの使用を推奨
   - プライベートチャンネルは明示的な招待が必要

3. **メッセージ内容** 📝
   - 個人情報は最小限に
   - Discord IDは含めない
   - 必要な情報のみ共有

---

## 7. 📈 パフォーマンス（処理速度）について

### 処理時間と制限

| 処理内容 | 時間 | 備考 |
|----------|------|------|
| 1つの通知送信 | 0.5秒以下 | 通常は即座に送信 |
| 10人分の通知 | 10〜15秒 | 1秒1メッセージの制限あり |
| まとめ通知 | 1秒以下 | 1つのメッセージにまとめる |

### Slack APIの制限
- **メッセージ送信**: 1秒に1メッセージまで
- **バースト制限**: 短時間の大量送信は避ける
- **1日の上限**: 特に制限なし（常識的な範囲で）

---

## 8. 📝 実際の使い方

### 日常的な運用の流れ

#### 朝の流れ
```
9:00 - 最初のメンバーがVCに参加
    ↓
Slackに通知: 「🎤 山田さんがログインしました！（通算 45 日目）」
    ↓
他のメンバーも参加
    ↓
それぞれ個別に通知
```

#### 夜のまとめ
```
21:00 - 1日の集計
    ↓
Slackに通知: 「📊 本日のVCログイン: 8名」
    ↓
参加者リストも表示
```

### 通知のカスタマイズ例

#### シンプルな通知
- 名前と日数のみ
- 最小限の情報

#### 詳細な通知
- 参加時間も含める
- 連続参加日数を表示
- ランキング形式

---

## 9. 💡 よくある質問（FAQ）

### Q1: 通知を止めることはできますか？
**A:** はい、プログラムを停止するか、Botの権限を削除すれば止まります。

### Q2: 特定の人だけ通知することは可能ですか？
**A:** 現在は全員を通知しますが、カスタマイズは可能です。

### Q3: 複数のチャンネルに送信できますか？
**A:** 設定を追加すれば可能ですが、現在は1チャンネルのみです。

### Q4: 過去の通知を見ることはできますか？
**A:** Slackのチャンネル履歴で確認できます。

### Q5: 通知の文言は変更できますか？
**A:** プログラムを修正すれば変更可能です。

---

## 10. 🔧 メンテナンスとアップデート

### 定期的な確認事項

#### 毎月確認すること
- [ ] Botトークンの有効性
- [ ] API使用量の確認
- [ ] エラーログの確認

#### トラブル時の対処
1. **エラーログを確認**
2. **Slack APIの状態を確認**
3. **トークンとチャンネルIDを再確認**
4. **必要に応じてBotを再インストール**

---

## 11. 🚧 今後の改善予定

### 近い将来追加したい機能
- 📱 スマホアプリからの設定変更
- 🎨 メッセージのデザインカスタマイズ
- ⏰ 通知時間の指定
- 📊 グラフや画像の添付

### 長期的な目標
- AIによる自動要約
- 音声通知機能
- 他のチャットツールとの連携
- ダッシュボード機能

---

## 12. 📚 もっと詳しく知りたい方へ

### 関連用語集

| 用語 | 説明 |
|------|------|
| **Slack** | ビジネス向けチャットツール |
| **Bot（ボット）** | 自動でメッセージを送るプログラム |
| **API** | プログラム同士が通信する仕組み |
| **トークン** | Botを識別するための秘密の文字列 |
| **チャンネルID** | Slackのチャンネルを識別する番号 |
| **Webhook** | 自動通知を送る別の方法 |

### 参考リンク
- [Slack API Documentation](https://api.slack.com) - 公式ドキュメント
- [Slack App Directory](https://slack.com/apps) - 他のAppの例
- [Block Kit Builder](https://app.slack.com/block-kit-builder) - メッセージデザインツール

---

## 📞 サポート

問題が発生した場合は、以下の情報を準備してお問い合わせください：

1. **エラーメッセージ**の全文
2. **いつ**エラーが発生したか
3. **どんな操作**をした時に起きたか
4. **Slack Appの設定**内容
5. **チャンネルの種類**（公開/プライベート）

この仕様書は定期的に更新されます。最新版は常にこのファイルを参照してください。

---

*最終更新日: 2025年1月*