# çµ±åˆãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸

## ğŸ“Œ ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦
Discord ãƒœãƒƒãƒˆã®ä¸»è¦æ©Ÿèƒ½ï¼ˆVCãƒ¡ãƒ³ãƒãƒ¼å–å¾—ã€CSVè¨˜éŒ²ã€æ—¥æ¬¡é›†è¨ˆï¼‰ã‚’çµ±åˆçš„ã«ãƒ†ã‚¹ãƒˆã™ã‚‹ä»•æ§˜æ›¸ã§ã™ã€‚èªè¨¼ç³»ã®æ¥ç¶šãƒ†ã‚¹ãƒˆã¨ã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ãŸæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã®ä¸¡æ–¹ã‚’å«ã¿ã¾ã™ã€‚

## ğŸ¯ ãƒ†ã‚¹ãƒˆç›®çš„

### èªè¨¼ç³»ãƒ†ã‚¹ãƒˆ
1. Discord APIã¸ã®æ¥ç¶šèªè¨¼ãŒæˆåŠŸã™ã‚‹ã“ã¨
2. Google Driveï¼ˆSheetsï¼‰ã¸ã®æ¥ç¶šèªè¨¼ãŒæˆåŠŸã™ã‚‹ã“ã¨
3. Slack APIã¸ã®æ¥ç¶šèªè¨¼ãŒæˆåŠŸã™ã‚‹ã“ã¨

### æ©Ÿèƒ½ç³»ãƒ†ã‚¹ãƒˆï¼ˆãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨ï¼‰
1. Discord VCãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±ã®å–å¾—ã¨è¨˜éŒ²ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨
2. CSVãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®å‡ºå¸­ãƒ‡ãƒ¼ã‚¿è¿½è¨˜ï¼ˆã‚¢ãƒšãƒ³ãƒ‰ï¼‰ãŒæ­£ç¢ºã§ã‚ã‚‹ã“ã¨
3. æ—¥æ¬¡é›†è¨ˆã¨Slacké€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ï¼ˆåœŸæ—¥ç¥æ—¥ã®é€£ç¶šå‡ºå¸­è¨ˆç®—ã‚’å«ã‚€ï¼‰

### ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆï¼ˆE2Eï¼‰
1. **discord_attendance_collector.py**ã®`main()`é–¢æ•°ã‚’ç›´æ¥å‘¼ã³å‡ºã—ã€å…¨ä½“ãƒ•ãƒ­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ
2. **slack_notifier_attendance.py**ã®`main()`é–¢æ•°ã‚’ç›´æ¥å‘¼ã³å‡ºã—ã€æ—¥æ¬¡é›†è¨ˆãƒ•ãƒ­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ
3. å®Ÿéš›ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã‚’é€šã—ã¦ã€ã‚¨ãƒ©ãƒ¼ãªãå®Œäº†ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

## ğŸ“¥ Inputï¼ˆå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ - MockInputDataï¼‰

### èªè¨¼ç³»ãƒ†ã‚¹ãƒˆ
| é …ç›® | å‹ | èª¬æ˜ | ä¾‹ |
|------|-----|------|-----|
| discord_token | str | Discord Bot Token | ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾— |
| google_credentials | JSON | Googleèªè¨¼æƒ…å ± | ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆJSON |
| slack_webhook_url | str | Slack Webhook URL | ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾— |

### æ©Ÿèƒ½ç³»ãƒ†ã‚¹ãƒˆ1: Discord VCãƒ¡ãƒ³ãƒãƒ¼å–å¾—
| é …ç›® | å‹ | èª¬æ˜ | ä¾‹ |
|------|-----|------|-----|
| mock_members | List[Dict] | æ“¬ä¼¼ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±ï¼ˆãƒ¢ãƒƒã‚¯å¯¾è±¡ï¼‰ | [{"id": "123456789", "name": "ç”°ä¸­å¤ªéƒ", "display_name": "ç”°ä¸­"}, {"id": "987654321", "name": "ä½è—¤èŠ±å­", "display_name": "ä½è—¤"}, {"id": "456789123", "name": "éˆ´æœ¨ä¸€éƒ", "display_name": "éˆ´æœ¨"}] |

### æ©Ÿèƒ½ç³»ãƒ†ã‚¹ãƒˆ2: CSVè¨˜éŒ²å‡¦ç†
| é …ç›® | å‹ | èª¬æ˜ | ä¾‹ |
|------|-----|------|-----|
| mock_template_data | str | æ—¢å­˜ã®CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | "æ—¥ä»˜,ç”°ä¸­,ä½è—¤,éˆ´æœ¨\n2025-01-16,1,1,0\n2025-01-17,0,1,1" |
| mock_members | List[str] | ãƒ†ã‚¹ãƒˆ1ã§å–å¾—ã—ãŸãƒ¡ãƒ³ãƒãƒ¼åãƒªã‚¹ãƒˆ | ["ç”°ä¸­", "ä½è—¤", "éˆ´æœ¨"] |

### æ©Ÿèƒ½ç³»ãƒ†ã‚¹ãƒˆ3: æ—¥æ¬¡é›†è¨ˆã¨Slacké€šçŸ¥
| é …ç›® | å‹ | èª¬æ˜ | ä¾‹ |
|------|-----|------|-----|
| mock_csv_data | str | é›†è¨ˆå¯¾è±¡ã®CSVãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ†ã‚¹ãƒˆ2ã®çµæœï¼‰ | "æ—¥ä»˜,ç”°ä¸­,ä½è—¤,éˆ´æœ¨\n2025-01-16,1,1,0\n2025-01-17,0,1,1\n2025-01-18,1,1,1" |
| target_date | str | é›†è¨ˆå¯¾è±¡æ—¥ï¼ˆåœŸæ›œæ—¥ï¼‰ | "2025-01-18" |

### ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ: discord_attendance_collector.py
| é …ç›® | å‹ | èª¬æ˜ | ä¾‹ |
|------|-----|------|-----|
| env_arg | str | ç’°å¢ƒå¼•æ•° | "1" ï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒï¼‰ |
| mock_discord_api | Mock | Discord APIã®ãƒ¢ãƒƒã‚¯ | VCå‚åŠ è€…ãƒªã‚¹ãƒˆã‚’è¿”ã™ãƒ¢ãƒƒã‚¯ |
| mock_drive_api | Mock | Google Drive APIã®ãƒ¢ãƒƒã‚¯ | CSVæ›¸ãè¾¼ã¿ã‚’ãƒ¢ãƒƒã‚¯ |

### ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ: daily_aggregator.py
| é …ç›® | å‹ | èª¬æ˜ | ä¾‹ |
|------|-----|------|-----|
| env_arg | str | ç’°å¢ƒå¼•æ•° | "1" ï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒï¼‰ |
| target_date | date | é›†è¨ˆå¯¾è±¡æ—¥ | "2025-01-18" |
| mock_csv_data | str | CSVãƒ‡ãƒ¼ã‚¿ | 1é€±é–“åˆ†ã®å‡ºå¸­ãƒ‡ãƒ¼ã‚¿ |
| mock_slack_api | Mock | Slack APIã®ãƒ¢ãƒƒã‚¯ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚’ãƒ¢ãƒƒã‚¯ |

## ğŸ“¤ Outputï¼ˆæœŸå¾…å€¤ãƒ‡ãƒ¼ã‚¿ - ExpectedDataï¼‰

### èªè¨¼ç³»ãƒ†ã‚¹ãƒˆ
| é …ç›® | å‹ | èª¬æ˜ | ä¾‹ |
|------|-----|------|-----|
| discord_connected | bool | Discordæ¥ç¶šæˆåŠŸ | True |
| google_connected | bool | Google Driveæ¥ç¶šæˆåŠŸ | True |
| slack_connected | bool | Slackæ¥ç¶šæˆåŠŸ | True |

### æ©Ÿèƒ½ç³»ãƒ†ã‚¹ãƒˆ1: Discord VCãƒ¡ãƒ³ãƒãƒ¼å–å¾—
| é …ç›® | å‹ | èª¬æ˜ | ä¾‹ |
|------|-----|------|-----|
| members_list | List[str] | å–å¾—ã—ãŸãƒ¡ãƒ³ãƒãƒ¼åãƒªã‚¹ãƒˆ | ["ç”°ä¸­", "ä½è—¤"] |
| status | bool | å–å¾—æˆåŠŸ/å¤±æ•— | True |

### æ©Ÿèƒ½ç³»ãƒ†ã‚¹ãƒˆ2: CSVè¨˜éŒ²å‡¦ç†
| é …ç›® | å‹ | èª¬æ˜ | ä¾‹ |
|------|-----|------|-----|
| updated_csv | str | æ›´æ–°å¾Œã®CSVãƒ‡ãƒ¼ã‚¿ | "æ—¥ä»˜,ç”°ä¸­,ä½è—¤\n2025-01-16,1,0\n2025-01-18,1,1" |
| is_match | bool | æœŸå¾…å€¤ã¨ã®ä¸€è‡´ç¢ºèª | True |

### æ©Ÿèƒ½ç³»ãƒ†ã‚¹ãƒˆ3: æ—¥æ¬¡é›†è¨ˆã¨Slacké€šçŸ¥
| é …ç›® | å‹ | èª¬æ˜ | ä¾‹ |
|------|-----|------|-----|
| slack_message | str | ç”Ÿæˆã•ã‚ŒãŸSlackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | "ã€æœ¬æ—¥ã®å‡ºå¸­ã€‘\nç”°ä¸­: ç´¯è¨ˆ4æ—¥, é€£ç¶š3æ—¥" |
| consecutive_calc_correct | bool | åœŸæ—¥ç¥ã‚’é™¤ãé€£ç¶šæ—¥æ•°è¨ˆç®—ãŒæ­£ç¢º | True |

### ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ: discord_attendance_collector.py
| é …ç›® | å‹ | èª¬æ˜ | ä¾‹ |
|------|-----|------|-----|
| exit_code | int | ãƒ—ãƒ­ã‚°ãƒ©ãƒ çµ‚äº†ã‚³ãƒ¼ãƒ‰ | 0ï¼ˆæ­£å¸¸çµ‚äº†ï¼‰ |
| csv_updated | bool | CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒæ›´æ–°ã•ã‚ŒãŸã‹ | True |
| log_output | str | ãƒ­ã‚°å‡ºåŠ›å†…å®¹ | "å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ" |
| error_count | int | ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ•° | 0 |

### ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ: daily_aggregator.py
| é …ç›® | å‹ | èª¬æ˜ | ä¾‹ |
|------|-----|------|-----|
| exit_code | int | ãƒ—ãƒ­ã‚°ãƒ©ãƒ çµ‚äº†ã‚³ãƒ¼ãƒ‰ | 0ï¼ˆæ­£å¸¸çµ‚äº†ï¼‰ |
| slack_sent | bool | Slackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚ŒãŸã‹ | True |
| stats_generated | bool | çµ±è¨ˆãŒæ­£ã—ãç”Ÿæˆã•ã‚ŒãŸã‹ | True |
| log_output | str | ãƒ­ã‚°å‡ºåŠ›å†…å®¹ | "é›†è¨ˆãŒå®Œäº†ã—ã¾ã—ãŸ" |

## ğŸ”§ å‡¦ç†ã®æµã‚Œ

### èªè¨¼ç³»ãƒ†ã‚¹ãƒˆ
1. å„ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®æ¥ç¶šãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
2. Discord: Botãƒˆãƒ¼ã‚¯ãƒ³ã§ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œ
3. Google Drive: ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§èªè¨¼è©¦è¡Œ
4. Slack: WebhookURLã¸ã®ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
5. å…¨ã¦ã®æ¥ç¶šãŒæˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèª

### æ©Ÿèƒ½ç³»çµ±åˆãƒ†ã‚¹ãƒˆ
1. **Discord VCãƒ¡ãƒ³ãƒãƒ¼å–å¾—ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰**
   - `on_ready`ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ¢ãƒƒã‚¯åŒ–
   - å›ºå®šã®mock_membersãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ã‚ˆã†ã«è¨­å®š
   - VCãƒ¡ãƒ³ãƒãƒ¼å–å¾—å‡¦ç†ã‚’å®Ÿè¡Œ

2. **CSVè¨˜éŒ²å‡¦ç†**
   - æ—¢å­˜ã®CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’mock_template_dataã§ä¸Šæ›¸ã
   - `csv_client.upsert_presence()`ã®å‰ã§ãƒ¢ãƒƒã‚¯åŒ–
   - ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±ã‚’CSVã«è¿½è¨˜ï¼ˆã‚¢ãƒšãƒ³ãƒ‰ï¼‰
   - æ›´æ–°å¾Œã®CSVãƒ‡ãƒ¼ã‚¿ã‚’æœŸå¾…å€¤ã¨æ¯”è¼ƒ

3. **æ—¥æ¬¡é›†è¨ˆã¨Slacké€šçŸ¥**
   - è¿½è¨˜ã•ã‚ŒãŸCSVãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
   - daily_aggregatorã®é›†è¨ˆå‡¦ç†ã‚’å®Ÿè¡Œ
   - `post_to_slack()`ãƒ¡ã‚½ãƒƒãƒ‰ã®å‡ºåŠ›ã‚’å–å¾—
   - åœŸæ—¥ç¥ã‚’é™¤ãé€£ç¶šãƒ­ã‚°ã‚¤ãƒ³æ—¥æ•°ã‚’æ¤œè¨¼
   - ç´¯è¨ˆæ—¥æ•°ã®æ­£ç¢ºæ€§ã‚’ç¢ºèª

### ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆï¼ˆE2Eï¼‰
1. **discord_attendance_collector.pyã®ãƒ†ã‚¹ãƒˆ**
   - ç’°å¢ƒå¤‰æ•°ã‚’ãƒ†ã‚¹ãƒˆç”¨ã«è¨­å®š
   - Discord APIã¨Google Drive APIã‚’ãƒ¢ãƒƒã‚¯åŒ–
   - `main()`é–¢æ•°ã‚’ç›´æ¥å‘¼ã³å‡ºã—ï¼ˆå¼•æ•°: `--env 1`ï¼‰
   - å‡¦ç†å…¨ä½“ãŒã‚¨ãƒ©ãƒ¼ãªãå®Œäº†ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
   - ãƒ­ã‚°å‡ºåŠ›ã‚’æ¤œè¨¼
   - çµ‚äº†ã‚³ãƒ¼ãƒ‰ãŒ0ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

2. **daily_aggregator.pyã®ãƒ†ã‚¹ãƒˆ**
   - ç’°å¢ƒå¤‰æ•°ã‚’ãƒ†ã‚¹ãƒˆç”¨ã«è¨­å®š
   - Google Drive APIã¨Slack APIã‚’ãƒ¢ãƒƒã‚¯åŒ–
   - `main()`é–¢æ•°ã‚’ç›´æ¥å‘¼ã³å‡ºã—ï¼ˆå¼•æ•°: `--env 1`ï¼‰
   - æ—¥æ¬¡é›†è¨ˆãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - Slackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - çµ‚äº†ã‚³ãƒ¼ãƒ‰ãŒ0ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

## ğŸ’¡ ä½¿ç”¨ä¾‹

```python
# èªè¨¼ç³»ãƒ†ã‚¹ãƒˆ
def test_authentication():
    """å…¨ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®æ¥ç¶šç¢ºèª"""
    assert test_discord_connection() == True
    assert test_google_drive_connection() == True
    assert test_slack_connection() == True

# çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨ï¼‰
def test_integration_with_mock():
    """ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§å…¨æ©Ÿèƒ½ã‚’çµ±åˆãƒ†ã‚¹ãƒˆ"""
    # 1. VCãƒ¡ãƒ³ãƒãƒ¼å–å¾—ï¼ˆå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ â†’ æœŸå¾…å€¤ã¨æ¯”è¼ƒï¼‰
    input_members = MockInputData.get_mock_members()
    members = get_vc_members_mock(input_members)
    expected_names = ExpectedData.get_member_names()
    assert members == expected_names  # ["ç”°ä¸­", "ä½è—¤", "éˆ´æœ¨"]

    # 2. CSVè¿½è¨˜å‡¦ç†ï¼ˆå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ â†’ æœŸå¾…å€¤ã¨æ¯”è¼ƒï¼‰
    template_csv = MockInputData.get_template_csv()
    today_members = MockInputData.get_today_members()
    updated_csv = append_to_csv(template_csv, today_members, "2025-01-18")
    expected_csv = ExpectedData.get_csv_after_append()
    assert updated_csv == expected_csv

    # 3. Slacké€šçŸ¥ï¼ˆæœŸå¾…å€¤ãƒ‡ãƒ¼ã‚¿ã§æ¤œè¨¼ï¼‰
    expected_stats = ExpectedData.get_stats_dict()
    message = generate_slack_message(expected_stats)
    expected_message = ExpectedData.get_expected_slack_message()

    # åœŸæ›œæ—¥ã ãŒã€å¹³æ—¥ã®é€£ç¶šå‡ºå¸­ã‚’æ­£ã—ãè¨ˆç®—
    assert "é€£ç¶šå‡ºå¸­: 3æ—¥" in message  # ç”°ä¸­: æœ¨é‡‘åœŸã§3æ—¥é€£ç¶š
    assert "é€£ç¶šå‡ºå¸­: 2æ—¥" in message  # ä½è—¤: é‡‘åœŸã§2æ—¥é€£ç¶š

# ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ: discord_attendance_collector.py
def test_e2e_discord_attendance_collector():
    """discord_attendance_collector.pyã®å…¨ä½“ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ"""
    import discord_attendance_collector

    # Discord APIã¨Google Drive APIã‚’ãƒ¢ãƒƒã‚¯åŒ–
    with patch('discord.Client') as mock_discord:
        with patch('googleapiclient.discovery.build') as mock_drive:
            # ãƒ¢ãƒƒã‚¯ã®è¨­å®š
            mock_discord.return_value.guilds = [mock_guild]
            mock_drive.return_value.files.return_value.create.return_value.execute.return_value = {'id': 'test_file_id'}

            # mainé–¢æ•°ã‚’ç›´æ¥å‘¼ã³å‡ºã—ï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒï¼‰
            sys.argv = ['discord_attendance_collector.py', '--env', '1']
            exit_code = discord_attendance_collector.main()

            # æ¤œè¨¼
            assert exit_code == 0, "ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒæ­£å¸¸çµ‚äº†ã—ãªã‹ã£ãŸ"
            assert mock_discord.called, "Discord APIãŒå‘¼ã³å‡ºã•ã‚Œãªã‹ã£ãŸ"
            assert mock_drive.called, "Google Drive APIãŒå‘¼ã³å‡ºã•ã‚Œãªã‹ã£ãŸ"

# ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ: daily_aggregator.py
def test_e2e_daily_aggregator():
    """daily_aggregator.pyã®å…¨ä½“ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ"""
    import daily_aggregator

    # Google Drive APIã¨Slack APIã‚’ãƒ¢ãƒƒã‚¯åŒ–
    with patch('googleapiclient.discovery.build') as mock_drive:
        with patch('slack_sdk.WebClient') as mock_slack:
            # ãƒ¢ãƒƒã‚¯ã®è¨­å®š
            mock_drive.return_value.files.return_value.get.return_value.execute.return_value = mock_csv_data
            mock_slack.return_value.chat_postMessage.return_value = {'ok': True}

            # mainé–¢æ•°ã‚’ç›´æ¥å‘¼ã³å‡ºã—ï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒï¼‰
            sys.argv = ['daily_aggregator.py', '--env', '1']
            exit_code = daily_aggregator.main()

            # æ¤œè¨¼
            assert exit_code == 0, "ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒæ­£å¸¸çµ‚äº†ã—ãªã‹ã£ãŸ"
            assert mock_drive.called, "Google Drive APIãŒå‘¼ã³å‡ºã•ã‚Œãªã‹ã£ãŸ"
            assert mock_slack.called, "Slack APIãŒå‘¼ã³å‡ºã•ã‚Œãªã‹ã£ãŸ"
```

## âš ï¸ æ³¨æ„äº‹é …
- ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã¯æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã¨åŒã˜å½¢å¼ã‚’ä¿ã¤ã“ã¨
- åœŸæ—¥ç¥æ—¥ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã¯`jpholiday`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨
- CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¯UTF-8ã‚’ä½¿ç”¨
- ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¯JSTï¼ˆUTC+9ï¼‰ã§çµ±ä¸€
- **ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆã§ã¯å®Ÿéš›ã®`main()`é–¢æ•°ã‚’å‘¼ã³å‡ºã™ãŸã‚ã€ç’°å¢ƒå¤‰æ•°ã®è¨­å®šã«æ³¨æ„**
- **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã¯å¿…ãš`--env 1`ï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨**

## ğŸ“Š ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### mock_membersï¼ˆDiscord VCãƒ¡ãƒ³ãƒãƒ¼ï¼‰
```json
[
  {
    "id": "123456789",
    "name": "ç”°ä¸­å¤ªéƒ",
    "display_name": "ç”°ä¸­",
    "joined_at": "2025-01-18 10:00:00",
    "status": "online"
  }
]
```

### mock_template_dataï¼ˆCSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰
```csv
æ—¥ä»˜,ç”°ä¸­,ä½è—¤,éˆ´æœ¨
2025-01-15,1,0,1
2025-01-16,1,1,0
2025-01-17,0,1,1
```

### expected_messageï¼ˆæœŸå¾…ã™ã‚‹Slackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰
```
ğŸ“Š ã€2025-01-18 ã‚‚ãã‚‚ãä¼š å‡ºå¸­çµ±è¨ˆã€‘ ğŸ“Š

æœ¬æ—¥ã®å‡ºå¸­è€…: 2å
- ç”°ä¸­: ç´¯è¨ˆå‡ºå¸­ 3æ—¥ | é€£ç¶šå‡ºå¸­ 2æ—¥ ğŸ”¥
- ä½è—¤: ç´¯è¨ˆå‡ºå¸­ 2æ—¥ | é€£ç¶šå‡ºå¸­ 1æ—¥

ç´ æ™´ã‚‰ã—ã„ç¶™ç¶šã§ã™ï¼
```

## â“ FAQ

**Q: ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã¯ã©ã“ã«ä¿å­˜ã™ã‚‹ï¼Ÿ**
A: `tests/fixtures/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã—ã¾ã™ã€‚

**Q: å®Ÿéš›ã®APIã‚’å‘¼ã³å‡ºã—ã¦ãƒ†ã‚¹ãƒˆã—ãŸã„å ´åˆã¯ï¼Ÿ**
A: ç’°å¢ƒå¤‰æ•°`USE_REAL_API=true`ã‚’è¨­å®šã™ã‚‹ã¨å®ŸAPIã‚’ä½¿ç”¨ã—ã¾ã™ï¼ˆCI/CDã§ã¯ä½¿ç”¨ä¸å¯ï¼‰ã€‚

**Q: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã‚’çŸ­ç¸®ã™ã‚‹ã«ã¯ï¼Ÿ**
A: `pytest -n auto`ã§ä¸¦åˆ—å®Ÿè¡Œã€ã¾ãŸã¯ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œï¼ˆ`pytest -k test_name`ï¼‰ã€‚