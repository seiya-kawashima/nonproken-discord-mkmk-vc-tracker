[tool.pytest.ini_options]
minversion = "7.4.0"  # pytest最小バージョン
addopts = [
    "-ra",  # 全テスト結果のサマリを表示
    "-v",  # 詳細な出力
    "--strict-markers",  # 未定義マーカーでエラー
    "--cov=src",  # srcディレクトリのカバレッジ測定
    "--cov=discord_attendance_collector.py",  # メインスクリプトもカバレッジ測定
    "--cov-report=term-missing",  # ターミナルに未カバー行を表示
    "--cov-report=html:htmlcov",  # HTMLレポート生成
    "--cov-report=xml",  # XMLレポート生成（CI用）
    "--cov-report=json",  # JSONレポート生成（詳細分析用）
    "--cov-branch",  # ブランチカバレッジも測定
]
testpaths = [
    "tests",
]
python_files = "test_*.py"
python_classes = "Test*"
python_functions = "test_*"
markers = [
    "slow: 実行時間の長いテスト",
    "integration: 統合テスト",
    "unit: 単体テスト",
]

[tool.coverage.run]
source = ["src", "."]  # srcディレクトリとルートディレクトリを測定
branch = true  # ブランチカバレッジも測定
omit = [
    "*/tests/*",  # テストコードは除外
    "*/test_*.py",  # テストファイルは除外
    "*/__pycache__/*",  # キャッシュは除外
    "*/venv/*",  # 仮想環境は除外
    "*/.venv/*",  # 仮想環境は除外
    "*/env/*",  # 仮想環境は除外
    "*/site-packages/*",  # インストール済みパッケージは除外
    "setup.py",  # セットアップファイルは除外
    "htmlcov/*",  # カバレッジレポートは除外
]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "if self.debug:",
    "if settings.DEBUG",
    "raise AssertionError",
    "raise NotImplementedError",
    "if 0:",
    "if __name__ == .__main__.:",
    "if TYPE_CHECKING:",
    "class .*\\bProtocol\\):",
    "@(abc\\.)?abstractmethod"
]
precision = 2
show_missing = true
skip_covered = false

[tool.coverage.html]
directory = "htmlcov"

[tool.coverage.xml]
output = "coverage.xml"